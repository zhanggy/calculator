let politics_obj={};var _result_list=[{name:"初始投资成本",id:"Z11",unit:"万元"},{name:"首年电量收益",id:"Z12",unit:"万元"},{name:"生命周期电量总收益",id:"Z13",unit:"万元"},{name:"补贴总收益",id:"Z14",unit:"万元"},{name:"生命周期总净收益",id:"Z15",unit:"万元"},{name:"静态投资回收期",id:"Z16",unit:"年"},{name:"静态收益率IRR",id:"Z17",unit:"%"},{name:"资本金收益率",id:"Z18",unit:"%"},{name:"度电成本",id:"Z19",unit:"元/KWh"}];function loan_interest_benjin(t,e,n){let i=12*e,l=n/100/12,o=t/i,a=new Array(i).fill(0),r=new Array(e).fill(0);for(let e=0;e<i;++e)a[e]=(t-o*e)*l,r[parseInt(e/12)]+=a[e];return r}function loan_interest_benxi(t,e,n){let i=12*e,l=n/100/12,o=new Array(i).fill(0),a=new Array(e).fill(0);for(let e=0;e<i;++e){let n=t*l*(Math.pow(1+l,i)-Math.pow(1+l,e))/(Math.pow(1+l,i)-1);o[e]=n,a[parseInt(e/12)]+=n}return a}function get_politics(t){let e=new Date,n=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString();data_url=document.location.pathname+"data/politics-"+n+".json",$.ajax({url:data_url,type:"GET",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8"},contentType:"application/json; charset=utf-8",success:function(e){politics_obj=e[t]||e.default,$("input#input_D").val(politics_obj["power-price"].peak),$("input#input_E").val(politics_obj["power-price"].usual),$("input#input_F").val(politics_obj["power-price"].vally)},error:function(t){console.error("Error")}})}function CalcROI(t){for(let e=1;e<t.length;++e){let n=t[e-1],i=t[e];if(n<0&&i>=0)return e+n/(n-i)}return t.length}function buildModule(){let t={};for(let e="A".charCodeAt();e<="T".charCodeAt();++e){let n=String.fromCharCode(e);t[n]=Number($("input#input_"+n).val())}if(!t.A||!t.B||!t.C)return console.log("no value"),-1;t.Z11=t.B*t.C/10,t.Z21=t.J*t.K/t.G*.2,2==t.J?t.Z22=t.D-(t.E+t.F)/2:t.Z22=t.D-t.F;let e=t.L;if(t.R>e&&(t.R=e),t.LIXI_YEAR=new Array(e).fill(0),t.N>0&&t.O>0&&t.P>0){let n=loan_interest_benjin(t.Z11*t.N/100,t.P,t.O);for(let i=0;i<e&&i<t.P;++i)t.LIXI_YEAR[i]=n[i]}t.Z13=0,t.Z14=0,t.Z24=0,t.Z25=0,t.Z26=0,t.Z27=0,t.CAP_YEAR=new Array(e).fill(0),t.DISCHARGE_YEAR=new Array(e).fill(0),t.SUBSIDY_YEAR=new Array(e).fill(0),t.BAT_INCOME_YEAR=new Array(e).fill(0),t.DEVOPS_YEAR=new Array(e).fill(0),t.PROFIT_YEAR=new Array(e).fill(0),t.CASH_YEAR=new Array(e).fill(0);let n=-t.Z11;for(let i=0;i<e;++i){t.CAP_YEAR[i]=t.B*(1-i*t.Z21);let e=t.H/100,l=t.I/100;t.DISCHARGE_YEAR[i]=t.J*t.K*e*l*t.CAP_YEAR[i]/1e4,t.Z24+=t.DISCHARGE_YEAR[i],t.BAT_INCOME_YEAR[i]=t.Z22*t.DISCHARGE_YEAR[i],i<t.R?t.SUBSIDY_YEAR[i]=t.Q*t.DISCHARGE_YEAR[i]:t.SUBSIDY_YEAR[i]=0,t.DEVOPS_YEAR[i]=t.B*t.M/10,t.Z25+=t.DEVOPS_YEAR[i],t.Z26+=t.LIXI_YEAR[i],t.Z27+=t.S,t.Z13+=t.BAT_INCOME_YEAR[i],t.Z14+=t.SUBSIDY_YEAR[i],t.PROFIT_YEAR[i]=t.BAT_INCOME_YEAR[i]+t.SUBSIDY_YEAR[i],t.PROFIT_YEAR[i]=t.PROFIT_YEAR[i]-t.LIXI_YEAR[i]-t.DEVOPS_YEAR[i],n+=t.PROFIT_YEAR[i],t.CASH_YEAR[i]=n}t.Z12=t.BAT_INCOME_YEAR[0],t.Z15=t.Z13+t.Z14-t.Z25-t.Z26-t.Z27,t.Z16=CalcROI(t.CASH_YEAR),t.Z17=t.Z15/t.L/t.Z11*100,t.Z18=t.Z15/t.L/(100-t.N)/t.Z11*1e4,t.Z19=(t.Z11*(100-t.T)/100+(t.Z25+t.Z26+t.Z27)/t.J*(t.E+t.F))/t.Z24,console.log(t),$("span#output_Z11").text(t.Z11.toFixed(2)),$("span#output_Z12").text(t.Z12.toFixed(2)),$("span#output_Z13").text(t.Z13.toFixed(2)),$("span#output_Z14").text(t.Z14.toFixed(2)),$("span#output_Z15").text(t.Z15.toFixed(2)),$("span#output_Z16").text(t.Z16.toFixed(2)),$("span#output_Z17").text(t.Z17.toFixed(2)),$("span#output_Z18").text(t.Z18.toFixed(2)),$("span#output_Z19").text(t.Z19.toFixed(2))}function onClickCalculate(){-1!=buildModule()&&$("div#layer-output").css("display","block")}function onClickReturn(){$("div#layer-input").css("display","block")}function init_result_table(t,e){let n=1;e.forEach((e=>{let i=$("<tr></tr>"),l=$("<td>"+n+++"</td>");i.append(l);let o=$("<td>"+e.name+"</td>");i.append(o);let a=$("<td><span id='output_"+e.id+"'></span></td>");i.append(a);let r=$("<td>"+e.unit+"</td>");i.append(r);let u=$("<td>"+(e.remark||"&nbsp;")+"</td>");i.append(u),$("#"+t).append(i)}))}$(document).ready((function(){init_result_table("tb_body_result",_result_list),get_politics("jiangsu"),$("button#btn-calc").click(onClickCalculate),$("button#btn-rtn").click(onClickReturn)}));